\section{smFRET data analysis}

\subsection{Introduction}

In the following we provide a high-level description of FRETbursts usage. In general, we suggest to import FRETbursts with the expression:

\begin{verbatim}
>>> import fretbursts as fb
\end{verbatim}

that will make available all the FRETBursts functions with a concise `fb.` prefix. In this article, however, we assume that FRETBursts is imported with the shortcut form:

\begin{verbatim}
>>> from fretbursts import *
\end{verbatim}

that allows to skip the \verb|fb.| prefix and also imports some common numeric libraries (numpy and matplotlib.pyplot imported as \verb|np| and \verb|plt| respectively).

\section{Architecture and concepts}
\subsection{Photon streams}
\label{sec:ph_streams}

The fundamental data at the core of smFRET experiments is the array of photon timestamps. In single-spot measurements, all the timestamps are stored in a single array. In multi-spot measurements we have as many timestamps array as the number of excitation spots.

Each timestamps array contains timestamps from both the donor (D) and the acceptor channel (A). In ALEX measurement, we can further differentiate between photons emitted during D and A excitation periods. In FRETBursts the different selection of photons/timestamps are called "photon streams" and they are specified with a \href{http://fretbursts.readthedocs.org/en/latest/data_class.html#module-fretbursts.ph_sel}{\texttt{Ph\_sel} object} . In non-ALEX smFRET data we have 3 base photon streams (table~\ref{tab:ph_sel_smfret}), while in ALEX data we have 5 base photon streams 
(table~\ref{tab:ph_sel_alex}).

The \href{http://fretbursts.readthedocs.org/en/latest/data_class.html#module-fretbursts.ph_sel}{\texttt{Ph\_sel} class} allows to express any combination of photon streams. 
For example, in ALEX measurements, the D-emission during A-excitation stream is usually excluded because it does not contain any useful signal\cite{Lee_2005}. To indicate all but the photons in this photon stream we write \verb|Ph_sel(Dex='DAem', Aex='Aem')|, that litteraly means \textit{select donor and acceptor photons (DAem) during donor excitation (Dex) and only acceptor photons (Aem) during acceptor excitation (Aex)}.

\begin{table}
\begin{tabular}{l|l}
  Photon selection  & code \\
  \hline
  All-photons       & \verb|Ph_sel('all')|\\
  D-emission    & \verb|Ph_sel(Dex='Dem')|\\
  A-emission & \verb|Ph_sel(Dex='Aem')|\\
\end{tabular}
\caption{\label{tab:ph_sel_smfret}Photon selection syntax (non-ALEX)}
\end{table}

\begin{table}
\begin{tabular}{l|l}
  Photon selection  & code \\
  \hline
  All-photons & \verb|Ph_sel('all')|\\
  D-emission during D-excitation & \verb|Ph_sel(Dex='Dem')|\\
  A-emission during D-excitation & \verb|Ph_sel(Dex='Aem')|\\
  D-emission during A-excitation & \verb|Ph_sel(Aex='Dem')|\\
  A-emission during A-excitation & \verb|Ph_sel(Aex='Aem')|\\
\end{tabular}
\caption{\label{tab:ph_sel_alex}Photon selection syntax (ALEX)}
\end{table}

\subsection{Background periods}
\label{sec:bg_intro}

Even when no molecule is crossing the excitation volume, there are “background counts” originating from detectors dark counting rates (DCR), samples scattering and auto-fluorescence. Figure~\ref{fig:bg_dist} shows the typical distribution of timestamps delays (waiting times between two subsequent timestamps) in a smFRET measurement. The “tail” of the distribution (a line in semi-log scale) corresponds to exponentially-distributed delays, indicating that those counts are generated by a \href{http://en.wikipedia.org/wiki/Poisson_process}{Poisson process}. At short timescales, the distribution departs from the exponential due to the bursts of photons from diffusing single-molecules (the signal). To estimate the background rate, (i.e. the exponential time constant) we need to select a minimum threshold above which the distribution can be considered exponential. Then, we need to chose a fit method, for example the Maximum Likelihood Estimation (MLE) or a curve fit of the histogram via non-linear least squares (NLSQ).

In practice, for burst search and burst correction, the background rates for all the different photon streams are needed. Furthermore, since the background rate can typically change during the measurement on time scales of tens of seconds or minutes, we want to estimate it periodically. FRETBursts splits the data in uniform time slices called \textit{background periods} and compute the background rates for each of these slices (see section~\ref{sec:bg_calc}). The slicing in background periods is also used during burst search to compute a background-dependent threshold and to apply the burst correction (section~\ref{sec:burstsearch}).


\subsection{The \texttt{Data} object}