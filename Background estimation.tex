\subsection{Background estimation}

The first step of smFRET analysis involves estimating the background level. In fact,  even when no molecule is crossing the excitation volume, there are "counts" originating from detectors dark counting rates (DCR), samples scattering and auto-fluorescence. Figure~\ref{fig:bgdist} shows the typical distribution of timestamps delays (waiting times between two subsequent timestamps) in a smFRET measurement. The "tail" of the distribution (a line in semi-log scale) corresponds to exponetially-distributed delays, indicating that a Poisson process is generating those counts. At short timescales, the distribution departs from the expontatial due to the single-molecule bursts of photons (the signal).
To estimate the background rate, (i.e. the expontential time constant) we need to select a minimum threshold above which the distribution can be considered exponential. 

In practice we need to estimate the background for all the different photon streams. Furthermore, since the background rate can typically changes during the measurement on scales of tens of seconds or minutes we to estimate it periodically. 
In FRETBursts we call \textit{backgroun period} the time dusration for each background estimation. For example, to compute the background every 30s, using a threshold of 2 ms for all the photon streams we use:

\verb|d.calc_bg(bg.exp_fit, time_s=30, tail_min_us=2000)|

The first argument is the actual fitting function used to fit the background in each period and for each photon stream. The second argument, time_s, is the background period and the third argument is the threshold above which the distribution is supposed to be exponential. It is possible to use a different threshold for each photon stream passing a tuple as tail_min_us (instead that a scalar). For an ALEX measurement the tuple needs to have 5 values corresponting to thresholds for the 5 photon streams. The list of photon streams for a \verb|Data| object can be found in the \verb|ph_streams| attribute (in the present example \verb|d.ph_streams|). Finally, is possible to use an heuristic estimation of the threshold using \verb|tail_min_us='auto'|. For more details refer to the \href{http://fretbursts.readthedocs.org/en/latest/data_class.html#fretbursts.burstlib.Data.calc_bg}{\verb|calc_bg| documentation}.

\verb|d.calc_bg(bg.exp_fit, time_s=1000, tail_min_us='auto', F_bg=1.7)|

\verb|d.calc_bg(bg.exp_fit, time_s=1000, tail_min_us='auto', F_bg=1.7)|

\begin{itemize}
\item Background as a function of time
\end{itemize}

\subsubsection{Choice of the threshold}
\begin{itemize}
\item heuristic
\item brute force
\end{itemize}

\subsection{Burst search}

Description of burst-search algorithms and why the m-photons sliding windows is exactly the same as fixed-time sliding window. Maybe a picture will help.

\begin{itemize}
\item Adaptive threshold as a function of background
\item Chosing different photon streams
\item AND-Gate
\end{itemize}

\subsection{Burst selection}

How to select bursts according to different criteria (size, width, E, S, topN, etc...).

How to define a new criterium.


\subsection{Population fit}

\begin{itemize}
\item Histogram fit: chose a model, constraints, methods, accuracy
\item KDE: find the maximum
\end{itemize}

\subsubsection{Correction coefficients}

\begin{itemize}
\item Fit D-only and A-only population.
\item Fit gamma factor.
\end{itemize}


\subsubsection{Accurate FRET}

Apply corrections to the bursts vs apply corrections after the fit.

