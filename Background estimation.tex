\subsection{Background estimation}
\label{sec:bg_calc}

The first step of smFRET analysis involves estimating the background level. For example, to compute the background every 30s, using a threshold of 2 ms for all the photon streams we execute: 

\begin{verbatim}
d.calc_bg(bg.exp_fit, time_s=30, tail_min_us=2000)
\end{verbatim}

Here, the first argument is the actual fitting function used to fit the
background in each period and for each photon stream~\ref{sec:bg_intro}. The function 
\verb|bg.exp_fit| fits the background using a Maximum Likelihood Estimation 
(MLE) of the delays distribution. More fitting functions are available in 
\verb|bg| namespace (see the 
\href{http://fretbursts.readthedocs.org/en/latest/background.html}
{\texttt{background} module}). The second argument, \verb|time_s|, is the 
\textit{background period} (section~\ref{sec:bg_intro}) and the third argument is the threshold above which the distribution is exponential. 
It is possible to use a different thresholds 
for each photon stream passing a \href{https://docs.python.org/2/tutorial/datastructures.html#tuples-and-sequences}{tuple} as \verb|tail_min_us| (instead 
of a scalar). For an ALEX measurement the tuple needs to have 5 values 
corresponding to thresholds for the 5 photon streams. The list of photon 
streams for a \verb|Data| object can be found in the \verb|ph_streams| 
attribute (in the present example \verb|d.ph_streams|). 

Finally, it is 
possible to use a heuristic estimation of the threshold using 
\verb|tail_min_us='auto'|. For more details refer to the 
\href{http://fretbursts.readthedocs.org/en/latest/data_class.html#fretbursts.burstlib.Data.calc_bg}{\texttt{calc\_bg} documentation}.

\subsubsection{Optimal threshold}
\begin{itemize}
\item Kolgomorov-Smirnov
\item Cramer von Mise
\end{itemize}
