\subsection{Burst selection}
\label{sec:burstsel}

After burst search, it is common to select bursts according to different
criteria. One of the most common is the burst size.

For instance, to select bursts with more than 30 photons (computed
after background correction) detected during the donor excitation
we use:

\begin{verbatim}
ds = d.select_bursts(select_bursts.size, th1=30)
\end{verbatim}

The previous command creates a new \textit{Data} variable (\verb|ds|) containing
the selected bursts.
As mentioned before the new object will share the photon data
arrays with the original object (\verb|d|) in order to minimize the RAM use.

The first argument of 
\href{http://fretbursts.readthedocs.org/en/latest/data_class.html#burst-selection-methods}{\texttt{select\_bursts()} method}
is the a python function implementing the "selection rule" (\verb|select_bursts.size| in this example);
all the remaining method arguments (only \verb|th1| in this case) are parameters of the selection rule.
The \href{http://fretbursts.readthedocs.org/en/latest/burst_selection.html}{\texttt{select\_bursts} module}
contains numerous
\href{http://fretbursts.readthedocs.org/en/latest/burst_selection.html#module-fretbursts.select_bursts}{built-in selection functions}.
For example,
\verb|select_bursts.ES|
is used to select a region on the E-S ALEX histogram,
\verb|select_bursts.width|
to select bursts based on their duration.
New criteria can be easily implemented by defining a new selection function,
usually not longer than a couple of lines (see the
\href{https://github.com/tritemio/FRETBursts/blob/master/fretbursts/select\_bursts.py}{\texttt{select\_bursts} module} for several examples).

Finally, different criteria can be combined by applying them sequentially.
For example, after the following commands:

\begin{verbatim}
ds = d.select_bursts(select_bursts.size,
                     th1=50, th2=200)
dsw = ds.select_bursts(select_bursts.width,
                       th1=0.5e-3, th2=3e-3)
\end{verbatim}

the variable \verb|dsw| will contain all bursts with sizes between 50 and
200 photons, and duration between 0.5 and 3~ms.

\subsubsection{Gamma-corrected burst size selection}

In the previous section, the definition of "burst size" was implicitly referring
to the total number of detected counts in the donor and in the acceptor channel
during donor excitation.

The selection command can be provided with an additional parameter in order to
also include photons detected in the acceptor channels during acceptor excitation.
This type of selection is shown in figure~\ref{fig:alex_jointplot} and is achieved 
by passing \verb|add_naa=True| as in the following command:

\begin{verbatim}
ds = d.select_bursts(select_bursts.size,
                     th1=30, add_naa=True)
\end{verbatim}

Another important parameter for defining the burst size is the gamma-factor, i.e.
the imbalance between the donor and the acceptor channels. The gamma-factor is
used to correct for the different fluorescence quantum yields of the D and A
fluorophores as well as the different photon-detection efficiencies of the D and A channels.
When gamma-factor is not 1, neglecting its effect on burst size leads to
over-representing one population versus to the other in terms of number of bursts.

When the gamma factor is known, it can be used to obtain a "fair" selection
of different populations by computing the burst size $n_t$ as:

$$ n_t = n_a + \gamma\,n_d$$ 

This expression is used by FRETBursts to compute the corrected burst size.
By default, $\gamma=1$ is assumed but a different value can be specified
using the argument \verb|gamma| (or \verb|gamma1|) during the selection:

\begin{verbatim}
ds = d.select_bursts(select_bursts.size,
                     th1=15, gamma=0.65)
\end{verbatim}

For more information on burst size selection refer to the
\href{http://fretbursts.readthedocs.org/en/latest/burst_selection.html#fretbursts.select\_bursts.size}{\texttt{select\_bursts.size} documentation}. Furthermore the \textit{Data} class provides the
\href{http://fretbursts.readthedocs.org/en/latest/data_class.html#fretbursts.burstlib.Data.burst_sizes}{method \texttt{Data.burst\_sizes()}} that returns the gamma-corrected burst sizes with or
without the addition of \verb|naa|.

\subsubsection{Select FRET Populations}

In smFRET-ALEX experiments, in addition to one or more the FRET populations, there are always
donor-only and acceptor-only populations. In most cases, these additional populations
are not of interest and would be better to filter them out.

In principle, using the E-S representation, we can exclude D-only and A-only bursts
by selecting bursts withing a range of $S$ values (e.g. S=0.2-0.8). 
This approach, however, simply truncates the burst distribution with arbitrary 
thresholds and is therefore not recommended for quantitative assessment of FRET 
populations.

A better approach consists in applying two selection filters one after the other.
First, we filter out the A-only population 
by applying a threshold on number of photons during donor excitation.
Second, we exclude the D-only population by
by applying a threshold on number of photons during acceptor excitation.
The commands to achieve this combined selections are:

\begin{verbatim}
ds1 = d.select_bursts(select_bursts.size, th1=15)
ds2 = ds1.select_bursts(select_bursts.naa, th1=15)
\end{verbatim}

