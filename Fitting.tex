\subsection{Population analysis}
\label{sec:fretfit}

Typically, after bursts selection, E or S histograms are fitted to a model.
FRETBursts \verb|mfit| module allows fitting histograms of bursts quantities
(i.e. E or S) with arbitrary models. In this context, a model is an object 
specifying a function, the parameters varied during the fit
and optional contraints for these parameters. This concept of model
is taken from \textit{lmfit}~\cite{lmfit}, the underlying library used by
FRETBursts to perform the fits.

Models can be created from arbitrary functions. For convenience,
FRETBursts allows to use predefined models such as 1 to 3 Gaussian
peaks or 2-Gaussian plus ``bridge''.
Built-in models are created calling a corresponding factory function
(names starting with \verb|mfit.factory_|) which initializes the parameters
with values and constraints suitable for E and S histograms fits.
(see \textit{Factory Functions} documentation, 
\href{http://fretbursts.readthedocs.org/en/latest/mfit.html#model-factory-functions}{link}).

Continuing our example, in order to fit the E histogram of bursts in the
\verb|ds| variable with two Gaussian peaks, we use the following command:

\begin{lstlisting}
bext.bursts_fitter(ds, 'E', binwidth=0.03,
                   model=mfit.factory_two_gaussians())
\end{lstlisting}

Changing \verb|'E'| with \verb|'S'| will fit the S histogram instead.
The argument \verb|binwidth| specifies the histogram bin width and 
the argument \verb|model| takes pre-initialized model used to be used for
fitting.

All fitting results (including best fit values, uncertainties, etc...), 
are stored in the \verb|E_fitter| (or \verb|S_fitter|)
attributes of the \verb|Data| variable (here named \verb|ds|).
In order to plot the fitted model with the FRET histogram, we pass the parameter
\verb|show_model=True| to \verb|hist_fret| function as follows
(see also section~\ref{sec:plotting}):

\begin{lstlisting}
dplot(ds, hist_fret, show_model=True)
\end{lstlisting}

For more examples on fitting bursts data and plotting results see the
μs-ALEX notebook (\href{http://nbviewer.jupyter.org/github/tritemio/FRETBursts_notebooks/blob/master/notebooks/FRETBursts%20-%20us-ALEX%20smFRET%20burst%20analysis.ipynb}{link}).
the \textit{Fitting Framework} section of the documentation 
(\href{http://fretbursts.readthedocs.org/en/latest/fit.html}{link})
as well as the \verb|bursts_fitter| function documentation
(\href{http://fretbursts.readthedocs.org/en/latest/plugins.html#fretbursts.burstlib\_ext.bursts\_fitter}{link}).

\paragraph{Python details}
Under the hood, histogram fit in FRETBursts is performed using the
\href{http://lmfit.github.io/lmfit-py/}{lmfit} library~\cite{lmfit}.
Every fit model is, in fact, an \verb|lmfit.Model| object, and these object
can be created and modified by calling directly \verb|lmfit| functions.
Fitting an lmfit \verb|Model| returns an object with all the results.
FRETBursts appends the fit result of each channel in the list 
\verb|ds.E_fitter.fit_res|.
Example of defining and modifying models for fitting are provided in 
the μs-ALEX FRETBursts tutorial (\href{http://nbviewer.jupyter.org/github/tritemio/FRETBursts_notebooks/blob/master/notebooks/FRETBursts%20-%20us-ALEX%20smFRET%20burst%20analysis.ipynb}{link}). 
Interested users should also refer to the excellent lmfit documentation
(\href{http://lmfit.github.io/lmfit-py/}{link}).
