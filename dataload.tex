\section{smFRET burst analysis}
\label{sec:analysis}

\subsection{Loading the data}
\label{sec:dataload}

FRETBursts supports loading data from a few file formats: SM files
(a binary format saved by a common LabVIEW program used in smFRET setups), 
SPC (a binary format used by TCSPC Becker \& Hickl cards) and 
\href{http://photon-hdf5.readthedocs.org/}{Photon-HDF5}  an open binary 
format single-molecule data based on HDF5. Support for additional file formats
can be added depending on user requests.

We encourage adopting \href{http://photon-hdf5.readthedocs.org/}{Photon-HDF5},
a format specifically designed for freely-diffusing smFRET and other timestamp-based data. 
Photon-HDF5 is a self-documented and efficient format
that allows saving both the raw data and the measurement-specific meta-data
(setup and sample information, authors, provenance etc...).
Photon-HDF5 assures long-term accessibility of the data and aims to ease data sharing 
among different software and research groups.
All the FRETBursts exemplary data files are saved in Photon-HDF5 and can be opened with 
standard viewers such as \href{http://www.hdfgroup.org/products/java/hdfview/}{HDFView}. 
Additional data files can be found here[multi-spot paper data files].

The \href{http://fretbursts.readthedocs.org/en/latest/loader.html}{\texttt{loader} module}
contains functions to load the different file formats. 
In particular, to load a Photon-HDF5 file we use the following command:

\begin{verbatim}
d = loader.photon_hdf5(file_name)
\end{verbatim}

where \verb|file_name| is a string containing the file path. The function
\verb|load.photon_hdf5| returns an object \verb|d| of type 
\href{http://fretbursts.readthedocs.org/en/latest/data_class.html}{\texttt{Data}}) 
containing all the measurement data (see section~\ref{sec:data_intro}).

Similar functions in the 
\href{http://fretbursts.readthedocs.org/en/latest/loader.html}{\texttt{loader} module} 
allow loading of other supported file formats.

\subsubsection{Load data manually}

In case the data is available in a format not directly supported by 
FRETBursts it is possible to manually create a \verb|Data| variable. 
For example, for non-ALEX smFRET data, two arrays of same length are 
needed: the timestamps and the acceptor-mask. The timestamps need to be 
an int64 numpy array containing the recorded photon timestamps in arbitrary 
units (usually dictated by the acquisition hardware clock period). 
The acceptor-mask needs to be a numpy boolean array that is \verb|True| 
when the corresponding timestamps comes from the acceptor channel and 
\verb|False| when it comes from the donor channel. Having these arrays a 
\verb|Data| object can be manually created with:

\begin{verbatim}
d = Data(ph_times_m=[timestamps], A_em=[acceptor_mask], 
         clk_p=10e-9, ALEX=False, nch=1, fname='file_name')
\end{verbatim}

In the previous example, we set the timestamp unit (\verb|clk_p|) to 10~ns 
and we specify that the data is not from an ALEX measurement. Creating 
\verb|Data| objects for ALEX and ns-ALEX measurements follows the same lines. 
We point the interested readers to the 
\href{https://github.com/tritemio/FRETBursts/blob/master/fretbursts/loader.py}{loader module source code} 
for other examples. 

\subsection{Alternation parameters}
\label{sec:alternation}

For µs-ALEX and ns-ALEX data it is necessary to identify the different 
alternation periods for donor and acceptor excitation.

The functions 
\verb|plot_alternation_hist| (\href{http://fretbursts.readthedocs.org/en/latest/plots.html#fretbursts.burst\_plot.plot\_alternation\_hist}{documentation})
plots the alternation histogram 
with the currently selected donor and acceptor excitation periods
(if no selection has been made yet, default values will be shown).
Figure~\ref{fig:altern_hist} shows a typical alternation histogram for
a µs-ALEX measurement with the donor and acceptor excitation periods highlighted.

In order to change the period definition shown in figure~\ref{fig:altern_hist}
the user can execute:

\begin{verbatim}
    d.add(D_ON=(2850, 580), A_ON=(900, 2580))
\end{verbatim}

where \verb|D_ON| and \verb|A_ON| are tuples representing 
the start-stop range for the donor and acceptor excitation periods 
in timestamps units. After changing the parameters, a new alternation plot will show the updated period selections.

When the alternation period definition is satisfactory, it can
be applied using the 
\href{http://fretbursts.readthedocs.org/en/latest/loader.html#fretbursts.loader.alex_apply_period}{\texttt{alex\_apply\_period} function}:

\begin{verbatim}
    loader.alex_apply_period(d)
\end{verbatim}

After running this command only the photons inside the defined excitation periods
will be present in \verb|d|, therefore in order to apply a new alternation period 
it is necessary to reload the file.

For ns-ALEX measurements the exact same functions and syntax are used.
This time, however, the plot function will show a Time-Correlated Single Photon Counting (TCSPC) histogram of two fluorescence decays originating from the two interspaced excitation sources. The period ranges will be expressed in nanotime units (TCSPC time bins) instead of 
timestamp units.
