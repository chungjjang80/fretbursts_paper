\subsection{Burst search}
\label{sec:burstsearch}

\subsubsection{Introduction to burst search}
After background estimation, the burst search is the next fundamental step of the analysis. The core "sliding window" algorithm, proposed by Eggeling~\textit{et al.} in 1998~\cite{Eggeling_1998}, involves searching for bursts of photons
in which $m$ consecutive photons are within a minimum time lag $\Delta t$. In other words, the bursts are the portions of the photon stream where the local a rate (computed using $m$ photons) is above a minimum rate chosen as a threshold. Eggeling did not provide any criteria on how to choose the rate threshold and the number of photons $m$ and as therefore it has become a common practice to manually tweak those parameters for each specific measurement. 

A more general approach consist in taking into account the background rate of the specific measurements and in choosing a rate threshold that is $F$ times larger than the background rate. This approach assures that the resulting bursts all have a single-to-background ratio (SBR) larger than $(F-1)$~\cite{Michalet_2012}. A consistent criterium to choose the threshold is very important when comparing different measurements with different background rates, when the background significantly changes during the measurements or in multi-spot measurements where each spot has a different background rates.

A second important aspect of burst search is which photon stream is processed. Usually, when identifying FRET populations, we want to apply the burst search to all the photons. Other times, when focusing on donor-only or acceptor only population, is better to use only the donor or acceptor signal. In general we want to be able to apply the burst search to an arbitrary selection of photons. In FRETBursts this can be achieved passing the appropriate \verb|Ph_sel| object to the burst search method (see section~\ref{sec:ph_streams} for more info on photon stream definitions).

Finally, Nir~\textit{et al.}~\cite{Nir_2006} proposed a dual-channel burst search (DCBS) that allows to mitigate artifacts due to photo-physical effects such as blinking. In this case a search is performer independently on two photon streams and bursts are marked only when both photon streams exhibit a rate higher than the threshold, 
implementing a kind of AND-gate logic. 
Usually, the term DCBS is refers to a burst search where the two photon streams are all the photons 
during donor excitation (\verb|Ph_sel(Dex='DAem')|) and acceptor channel photons during acceptor 
excitation (\verb|Ph_sel(Aex='Aem')|).

\subsubsection{Burst search in FRETBursts}
\label{sec:burstsearch-intro}

In FRETBursts the standard burst search is performed calling the \href{http://fretbursts.readthedocs.org/en/latest/data_class.html#fretbursts.burstlib.Data.burst_search_t}{\verb|burst_search_t| method}.

\begin{verbatim}
d.burst_search_t(F=6, m=10, ph_sel=Ph_sel('all'))
\end{verbatim}

The previous command perfoms a burst search on all photons (\verb|ph_sel=Ph_sel('all')|), with a minimum rate 6 times larger than the background rate (\verb|F=6|) and using 10 consecutive photons to compute the local rate (\verb|m=10|).
A different photon selection, threshold ($F$) or number of photons for rate computation $m$ can be selected by passing a different value. These parameters are generally a good starting point for smFRET analysis but can be tweaked in specific cases.

When there is a need to perform a burst-search using a fixed threshold (independent from the background rate), 
the \verb|min_rate| argument can be used as follows (considering a minimum rate threshold of 50~kHz):

\begin{verbatim}
d.burst_search_t(rate_min=50e3, m=10, ph_sel=Ph_sel('all'))
\end{verbatim}

Finally, to perform a DCBS burst search (or in general an AND-gate burst search, see section~\ref{sec:burstsearch-intro}) the plugin function \href{http://fretbursts.readthedocs.org/en/latest/plugins.html#fretbursts.burstlib_ext.burst_search_and_gate}{\verb|burst_search_and_gate|} can be used. For example:

\begin{verbatim}
d.burst_search_t(rate_min=50e3, m=10, ph_sel=Ph_sel('all'))
\end{verbatim}

The optinal arguments \verb|ph_sel1| and \verb|ph_sel2| default to the photons streams for DCBS. Any other AND-gate burst search can be performed between two photon streams simply passing a different photon selection.

\subsection{Burst selection}

How to select bursts according to different criteria (size, width, E, S, topN, etc...).

How to define a new criterium.


\subsection{Population fit}

\begin{itemize}
\item Histogram fit: chose a model, constraints, methods, accuracy
\item KDE: find the maximum
\end{itemize}

\subsubsection{Correction coefficients}

\begin{itemize}
\item Fit D-only and A-only population.
\item Fit gamma factor.
\end{itemize}


\subsubsection{Accurate FRET}

Apply corrections to the bursts vs apply corrections after the fit.

